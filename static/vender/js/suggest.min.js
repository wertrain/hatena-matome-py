/*
--------------------------------------------------------
suggest.js - Input Suggest
Version 2.3 (Update 2013/02/11)

Copyright (c) 2006-2013 onozaty (http://www.enjoyxstudy.com)

Released under an MIT-style license.

For details, see the web site:
 http://www.enjoyxstudy.com/javascript/suggest/

--------------------------------------------------------
*/
if(!Suggest)var Suggest={};Suggest.Key={TAB:9,RETURN:13,ESC:27,UP:38,DOWN:40},Suggest.copyProperties=function(t,e){for(var i in e)t[i]=e[i];return t},Suggest.Local=function(){this.initialize.apply(this,arguments)},Suggest.Local.prototype={initialize:function(t,e,i){this.input=this._getElement(t),this.suggestArea=this._getElement(e),this.candidateList=i,this.oldText=this.getInputText(),arguments[3]&&this.setOptions(arguments[3]),this._addEvent(this.input,"focus",this._bind(this.checkLoop)),this._addEvent(this.input,"blur",this._bind(this.inputBlur)),this._addEvent(this.suggestArea,"blur",this._bind(this.inputBlur)),this._addEvent(this.input,"keydown",this._bindEvent(this.keyEvent)),this.clearSuggestArea()},interval:500,dispMax:20,listTagName:"div",prefix:!1,ignoreCase:!0,highlight:!1,dispAllKey:!1,classMouseOver:"over",classSelect:"select",hookBeforeSearch:function(){},setOptions:function(t){Suggest.copyProperties(this,t)},inputBlur:function(){setTimeout(this._bind(function(){document.activeElement!=this.suggestArea&&document.activeElement!=this.input&&(this.changeUnactive(),this.oldText=this.getInputText(),this.timerId&&clearTimeout(this.timerId),this.timerId=null,setTimeout(this._bind(this.clearSuggestArea),500))},500))},checkLoop:function(){var t=this.getInputText();t!=this.oldText&&(this.oldText=t,this.search()),this.timerId&&clearTimeout(this.timerId),this.timerId=setTimeout(this._bind(this.checkLoop),this.interval)},search:function(){this.clearSuggestArea();var t=this.getInputText();if(""!=t&&null!=t){this.hookBeforeSearch(t);var e=this._search(t);0!=e.length&&this.createSuggestArea(e)}},_search:function(t){var e,i=[];this.suggestIndexList=[];for(var s=0,n=this.candidateList.length;n>s&&!(null!=(e=this.isMatch(this.candidateList[s],t))&&(i.push(e),this.suggestIndexList.push(s),0!=this.dispMax&&i.length>=this.dispMax));s++);return i},isMatch:function(t,e){if(null==t)return null;var i=this.ignoreCase?t.toLowerCase().indexOf(e.toLowerCase()):t.indexOf(e);return-1==i||this.prefix&&0!=i?null:this.highlight?this._escapeHTML(t.substr(0,i))+"<strong>"+this._escapeHTML(t.substr(i,e.length))+"</strong>"+this._escapeHTML(t.substr(i+e.length)):this._escapeHTML(t)},clearSuggestArea:function(){this.suggestArea.innerHTML="",this.suggestArea.style.display="none",this.suggestList=null,this.suggestIndexList=null,this.activePosition=null},createSuggestArea:function(t){this.suggestList=[],this.inputValueBackup=this.input.value;for(var e=0,i=t.length;i>e;e++){var s=document.createElement(this.listTagName);s.innerHTML=t[e],this.suggestArea.appendChild(s),this._addEvent(s,"click",this._bindEvent(this.listClick,e)),this._addEvent(s,"mouseover",this._bindEvent(this.listMouseOver,e)),this._addEvent(s,"mouseout",this._bindEvent(this.listMouseOut,e)),this.suggestList.push(s)}this.suggestArea.style.display="",this.suggestArea.scrollTop=0},getInputText:function(){return this.input.value},setInputText:function(t){this.input.value=t},keyEvent:function(t){this.timerId||(this.timerId=setTimeout(this._bind(this.checkLoop),this.interval)),this.dispAllKey&&t.ctrlKey&&""==this.getInputText()&&!this.suggestList&&t.keyCode==Suggest.Key.DOWN?(this._stopEvent(t),this.keyEventDispAll()):t.keyCode==Suggest.Key.UP||t.keyCode==Suggest.Key.DOWN?this.suggestList&&0!=this.suggestList.length&&(this._stopEvent(t),this.keyEventMove(t.keyCode)):t.keyCode==Suggest.Key.RETURN?this.suggestList&&0!=this.suggestList.length&&(this._stopEvent(t),this.keyEventReturn()):t.keyCode==Suggest.Key.ESC?this.suggestList&&0!=this.suggestList.length&&(this._stopEvent(t),this.keyEventEsc()):this.keyEventOther(t)},keyEventDispAll:function(){this.clearSuggestArea(),this.oldText=this.getInputText(),this.suggestIndexList=[];for(var t=0,e=this.candidateList.length;e>t;t++)this.suggestIndexList.push(t);this.createSuggestArea(this.candidateList)},keyEventMove:function(t){if(this.changeUnactive(),t==Suggest.Key.UP){if(null==this.activePosition)this.activePosition=this.suggestList.length-1;else if(this.activePosition--,this.activePosition<0)return this.activePosition=null,this.input.value=this.inputValueBackup,void(this.suggestArea.scrollTop=0)}else if(null==this.activePosition?this.activePosition=0:this.activePosition++,this.activePosition>=this.suggestList.length)return this.activePosition=null,this.input.value=this.inputValueBackup,void(this.suggestArea.scrollTop=0);this.changeActive(this.activePosition)},keyEventReturn:function(){this.clearSuggestArea(),this.moveEnd()},keyEventEsc:function(){this.clearSuggestArea(),this.input.value=this.inputValueBackup,this.oldText=this.getInputText(),window.opera&&setTimeout(this._bind(this.moveEnd),5)},keyEventOther:function(t){},changeActive:function(t){this.setStyleActive(this.suggestList[t]),this.setInputText(this.candidateList[this.suggestIndexList[t]]),this.oldText=this.getInputText(),this.input.focus()},changeUnactive:function(){null!=this.suggestList&&this.suggestList.length>0&&null!=this.activePosition&&this.setStyleUnactive(this.suggestList[this.activePosition])},listClick:function(t,e){this.changeUnactive(),this.activePosition=e,this.changeActive(e),this.clearSuggestArea(),this.moveEnd()},listMouseOver:function(t,e){this.setStyleMouseOver(this._getEventElement(t))},listMouseOut:function(t,e){if(this.suggestList){var i=this._getEventElement(t);e==this.activePosition?this.setStyleActive(i):this.setStyleUnactive(i)}},setStyleActive:function(t){t.className=this.classSelect;var e=t.offsetTop,i=e+t.clientHeight;this.suggestArea.scrollTop>e?this.suggestArea.scrollTop=e:this.suggestArea.scrollTop+this.suggestArea.clientHeight<i&&(this.suggestArea.scrollTop=i-this.suggestArea.clientHeight)},setStyleUnactive:function(t){t.className=""},setStyleMouseOver:function(t){t.className=this.classMouseOver},moveEnd:function(){if(this.input.createTextRange){this.input.focus();var t=this.input.createTextRange();t.move("character",this.input.value.length),t.select()}else this.input.setSelectionRange&&this.input.setSelectionRange(this.input.value.length,this.input.value.length)},_getElement:function(t){return"string"==typeof t?document.getElementById(t):t},_addEvent:window.addEventListener?function(t,e,i){t.addEventListener(e,i,!1)}:function(t,e,i){t.attachEvent("on"+e,i)},_stopEvent:function(t){t.preventDefault?(t.preventDefault(),t.stopPropagation()):(t.returnValue=!1,t.cancelBubble=!0)},_getEventElement:function(t){return t.target||t.srcElement},_bind:function(t){var e=this,i=Array.prototype.slice.call(arguments,1);return function(){t.apply(e,i)}},_bindEvent:function(t){var e=this,i=Array.prototype.slice.call(arguments,1);return function(s){s=s||window.event,t.apply(e,[s].concat(i))}},_escapeHTML:function(t){return t.replace(/\&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\"/g,"&quot;").replace(/\'/g,"&#39;")}},Suggest.LocalMulti=function(){this.initialize.apply(this,arguments)},Suggest.copyProperties(Suggest.LocalMulti.prototype,Suggest.Local.prototype),Suggest.LocalMulti.prototype.delim=" ",Suggest.LocalMulti.prototype.keyEventReturn=function(){this.clearSuggestArea(),this.input.value+=this.delim,this.moveEnd()},Suggest.LocalMulti.prototype.keyEventOther=function(t){t.keyCode==Suggest.Key.TAB&&this.suggestList&&0!=this.suggestList.length&&(this._stopEvent(t),this.activePosition||(this.activePosition=0,this.changeActive(this.activePosition)),this.clearSuggestArea(),this.input.value+=this.delim,window.opera?setTimeout(this._bind(this.moveEnd),5):this.moveEnd())},Suggest.LocalMulti.prototype.listClick=function(t,e){this.changeUnactive(),this.activePosition=e,this.changeActive(e),this.input.value+=this.delim,this.clearSuggestArea(),this.moveEnd()},Suggest.LocalMulti.prototype.getInputText=function(){var t=this.getLastTokenPos();return-1==t?this.input.value:this.input.value.substr(t+1)},Suggest.LocalMulti.prototype.setInputText=function(t){var e=this.getLastTokenPos();-1==e?this.input.value=t:this.input.value=this.input.value.substr(0,e+1)+t},Suggest.LocalMulti.prototype.getLastTokenPos=function(){return this.input.value.lastIndexOf(this.delim)};